!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):((t=t||self).nvpack=t.nvpack||{},t.nvpack.heatmaps=i())}(this,function(){"use strict";var t="https://heatmaps.notifyvisitors.com/",i="https://heatcron1.notifyvisitors.com/",e="notify_visitors",n={urls:{heatmapSettings:t+"brand/t1/hs",heatmapData:t+"brand/t2/heatmapData",heatmapData_new:t+"brand/t2_new/heatmapData",heatmapUrl:t,heatcronUrl:i,socketPath:"/socket/socket.io",contentUrl:t+"endapi/content/data",contentUrlHeat:i+"endapi/content/data",hmContentUrl:t+"endapi/hmContent/data",awsWebSocketUrl:"wss://wsshm.notifyvisitors.com"},js_urls:{hm:t+"js/heatmap/hm_paint.js",ab:"https://optimiser.notifyvisitors.com/js/abTest/bootEditor.js",socket:"https://cdn.notifyvisitors.com/ext/external/socket.js"}},r=function(){var t={startStopTimes:{},idleTimeoutMs:3e4,currentIdleTimeMs:0,checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:function(i){var e=document.getElementById(i);e&&(e.addEventListener("mouseover",function(){t.startTimer(i)}),e.addEventListener("mousemove",function(){t.startTimer(i)}),e.addEventListener("mouseleave",function(){t.stopTimer(i)}),e.addEventListener("keypress",function(){t.startTimer(i)}),e.addEventListener("focus",function(){t.startTimer(i)}))},getTimeOnElementInSeconds:function(i){var e=t.getTimeOnPageInSeconds(i);return e||0},startTimer:function(i){if(i||(i=t.currentPageName),void 0===t.startStopTimes[i])t.startStopTimes[i]=[];else{var e=t.startStopTimes[i],n=e[e.length-1];if(void 0!==n&&void 0===n.stopTime)return}t.startStopTimes[i].push({startTime:new Date,stopTime:void 0}),t.active=!0},stopAllTimers:function(){for(var i=Object.keys(t.startStopTimes),e=0;e<i.length;e++)t.stopTimer(i[e])},stopTimer:function(i){i||(i=t.currentPageName);var e=t.startStopTimes[i];void 0!==e&&0!==e.length&&(void 0===e[e.length-1].stopTime&&(e[e.length-1].stopTime=new Date),t.active=!1)},getTimeOnCurrentPageInSeconds:function(){return t.getTimeOnPageInSeconds(t.currentPageName)},getTimeOnPageInSeconds:function(i){return void 0===t.getTimeOnPageInMilliseconds(i)?void 0:t.getTimeOnPageInMilliseconds(i)/1e3},getTimeOnCurrentPageInMilliseconds:function(){return t.getTimeOnPageInMilliseconds(t.currentPageName)},getTimeOnPageInMilliseconds:function(i){var e=t.startStopTimes[i];if(void 0!==e){for(var n=0,r=0;r<e.length;r++){var s=e[r].startTime,o=e[r].stopTime;void 0===o&&(o=new Date),n+=o-s}return Number(n)}},getTimeOnAllPagesInSeconds:function(){for(var i=[],e=Object.keys(t.startStopTimes),n=0;n<e.length;n++){var r=e[n],s=t.getTimeOnPageInSeconds(r);i.push({pageName:r,timeOnPage:s})}return i},setIdleDurationInSeconds:function(i){var e=parseFloat(i);if(!1!==isNaN(e))throw{name:"InvalidDurationException",message:"An invalid duration time ("+i+") was provided."};return t.idleTimeoutMs=1e3*i,this},setCurrentPageName:function(i){return t.currentPageName=i,this},resetRecordedPageTime:function(i){delete t.startStopTimes[i]},resetAllRecordedPageTimes:function(){for(var i=Object.keys(t.startStopTimes),e=0;e<i.length;e++)t.resetRecordedPageTime(i[e])},resetIdleCountdown:function(){t.idle&&t.triggerUserHasReturned(),t.idle=!1,t.currentIdleTimeMs=0},callWhenUserLeaves:function(t,i){this.userLeftCallbacks.push({callback:t,numberOfTimesToInvoke:i})},callWhenUserReturns:function(t,i){this.userReturnCallbacks.push({callback:t,numberOfTimesToInvoke:i})},triggerUserHasReturned:function(){if(!t.active)for(var i=0;i<this.userReturnCallbacks.length;i++){var e=this.userReturnCallbacks[i],n=e.numberOfTimesToInvoke;(isNaN(n)||void 0===n||n>0)&&(e.numberOfTimesToInvoke-=1,e.callback())}t.startTimer()},triggerUserHasLeftPage:function(){if(t.active)for(var i=0;i<this.userLeftCallbacks.length;i++){var e=this.userLeftCallbacks[i],n=e.numberOfTimesToInvoke;(isNaN(n)||void 0===n||n>0)&&(e.numberOfTimesToInvoke-=1,e.callback())}t.stopAllTimers()},callAfterTimeElapsedInSeconds:function(i,e){t.timeElapsedCallbacks.push({timeInSeconds:i,callback:e,pending:!0})},checkState:function(){for(var i=0;i<t.timeElapsedCallbacks.length;i++)t.timeElapsedCallbacks[i].pending&&t.getTimeOnCurrentPageInSeconds()>t.timeElapsedCallbacks[i].timeInSeconds&&(t.timeElapsedCallbacks[i].callback(),t.timeElapsedCallbacks[i].pending=!1);!1===t.idle&&t.currentIdleTimeMs>t.idleTimeoutMs?(t.idle=!0,t.triggerUserHasLeftPage()):t.currentIdleTimeMs+=t.checkStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function(){void 0!==document.hidden?(t.hiddenPropName="hidden",t.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(t.hiddenPropName="mozHidden",t.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(t.hiddenPropName="msHidden",t.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(t.hiddenPropName="webkitHidden",t.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(t.visibilityChangeEventName,function(){document[t.hiddenPropName]?t.triggerUserHasLeftPage():t.triggerUserHasReturned()},!1),window.addEventListener("blur",function(){t.triggerUserHasLeftPage()}),window.addEventListener("focus",function(){t.triggerUserHasReturned()}),document.addEventListener("mousemove",function(){t.resetIdleCountdown()}),document.addEventListener("keyup",function(){t.resetIdleCountdown()}),document.addEventListener("touchstart",function(){t.resetIdleCountdown()}),window.addEventListener("scroll",function(){t.resetIdleCountdown()}),setInterval(function(){t.checkState()},t.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function(i){if(window.WebSocket&&i){var e=i.websocketHost;try{t.websocket=new WebSocket(e),window.onbeforeunload=function(e){t.sendCurrentTime(i.appId)},t.websocket.onopen=function(){t.sendInitWsRequest(i.appId)},t.websocket.onerror=function(t){console&&console.log("Error occurred in websocket connection: "+t)},t.websocket.onmessage=function(t){console&&console.log(t.data)}}catch(t){console&&console.error("Failed to connect to websocket host.  Error:"+t)}}return this},websocketSend:function(i){t.websocket.send(JSON.stringify(i))},sendCurrentTime:function(i){var e={type:"INSERT_TIME",appId:i,timeOnPageMs:t.getTimeOnCurrentPageInMilliseconds(),pageName:t.currentPageName};t.websocketSend(e)},sendInitWsRequest:function(i){var e={type:"INIT",appId:i};t.websocketSend(e)},initialize:function(i){var e=t.idleTimeoutMs||30,n=t.currentPageName||"default-page-name",r=void 0;i&&(e=i.idleTimeoutInSeconds||e,n=i.currentPageName||n,r=i.websocketOptions),t.setIdleDurationInSeconds(e).setCurrentPageName(n).setUpWebsocket(r).listenForVisibilityEvents(),t.startTimer()}};return t}(),s=window[e].Optimize.data,o=null,a=null,h=()=>{o=new Date},u=()=>(null===o&&h(),o),c=()=>{a=new Date},f=()=>(null===a&&c(),a),d=()=>{r.initialize({currentPageName:location.href,idleTimeoutInSeconds:10})},v=()=>r,l=t=>{var i=t.getBoundingClientRect();return{top:i.top+window.scrollY,left:i.left+window.scrollX}},m=()=>{function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},w=t=>{if(!t)throw new TypeError("`CSS.escape` requires an argument.");for(var i,e=String(t),n=e.length,r=-1,s="",o=e.charCodeAt(0);++r<n;)0!=(i=e.charCodeAt(r))?s+=i>=1&&i<=31||127==i||0==r&&i>=48&&i<=57||1==r&&i>=48&&i<=57&&45==o?"\\"+i.toString(16)+" ":(0!=r||1!=n||45!=i)&&(i>=128||45==i||95==i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122)?e.charAt(r):"\\"+e.charAt(r):s+="ï¿½";return s},b=t=>{var i=["over","hover","active","selected","scrolled","collapsed"];if("object"!=typeof t)throw new Error("expects dom node");var e="";if("HTML"===t.nodeName)return"html";do{var n="";if("HTML"===t.nodeName|"#document"===t.nodeName){e+=n;break}if(t.id){e+=n+=" #"+t.id;break}if("BODY"!==t.nodeName){if(t.className){if("string"!=typeof t.className)return null;n+=" "+t.nodeName.toLowerCase()+t.className.trim().split(/\s+/).map(function(t){return-1===i.indexOf(t)?"."+w(t):""}).join(""),t.parentNode.childNodes.length>1&&t.parentNode.querySelectorAll(n).length>1&&(n+=":nth-child("+p(t)+")")}else n+=" "+t.nodeName.toLowerCase(),t.parentNode.childNodes.length>1&&t.parentNode.querySelectorAll(n).length>1&&(n+=":nth-child("+p(t)+")");e+=n}else e+=n+=" body"}while(t=t.parentNode);return(e=e.split(" ").reverse().join(" "))||null},p=t=>{for(var i=1;t=t.previousElementSibling;)++i;return i},k=t=>{var i,e,n,r;return r=t%1e3,n=Math.floor(t/1e3),e=Math.floor(n/60),n%=60,i=Math.floor(e/60),e%=60,{d:Math.floor(i/24),h:i%=24,m:e,s:n,ms:r}},g=t=>864e5*t.d+36e5*t.h+6e4*t.m+1e3*t.s+t.ms,y=t=>{var i={abTest:!1,heatMap:!1,form_data:!1,split:!1,recording:!1};return"object"==typeof t.heatmaps&&t.heatmaps.hasOwnProperty("status")&&(i.heatMap=!0),t.hasOwnProperty("abTest")&&t.abTest&&"object"==typeof t.abTest&&(t.abTest.campDetail&&"1"==t.abTest.campDetail.type?i.split=!0:i.abTest=!0,t.abTest.hasOwnProperty("visitorData")&&t.abTest.visitorData&&"object"==typeof t.abTest.visitorData&&(s.abTest.visitorData=t.abTest.visitorData)),t.hasOwnProperty("form_data")&&"object"==typeof t.form_data&&t.form_data.form_id.length>0&&(i.form_data=!0),t.hasOwnProperty("recording")&&"object"==typeof t.recording&&t.recording.hasOwnProperty("status")&&(i.recording=!0),i},O=t=>{var i=[],e=(t=>{var i=0,e=t=>{if(null!=t){var n=Object.prototype.toString.call(t).slice(8,-1);switch(typeof t){case"number":i+=8;break;case"string":i+=2*t.length;break;case"boolean":i+=4;break;case"object":"Object"===n||"Array"===n?Object.keys(t).forEach(i=>{Object.prototype.hasOwnProperty.call(t,i)&&e(t[i])}):i+=2*t.toString().length}}return i};return(t=>{var i="";return t<1024?i=t+" bytes":t&&(i=(t/1024).toFixed(3)+" KiB"),i})(e(t))})(t).split(" "),n=Math.ceil(e[0]);switch(e[1]){case"KiB":if(n>50){var r=Math.ceil(n/50),s=((t,i)=>{for(var e=[],n=Math.ceil(t/i),r=t-n*(i-1),s=0;s<=i;s++)s!==i?e.push(n*s):e.push(e[e.length-1]+r);return e})(JSON.stringify(t).length,r);i=((t,i)=>{var e=[];if(t&&i&&"string"==typeof t&&Array.isArray(i)&&t.length>0&&i.length>0)for(var n=0;n<i.length-1;n++)e.push(t.slice(i[n],i[n+1]));return e})(JSON.stringify(t),s)}}return i};class S{constructor(){this.document=window.document}set(t,i,e,n){var r=new Date((new Date).setHours(23,59,59,0));e=e||0==e?"expires="+e:"expires="+r,n=n?"domain=."+n:"",document.cookie=t+"="+i+"; "+e+"; "+n+"; path=/"}get(t){for(var i=t+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){var r=e[n].trim();if(0==r.indexOf(i))return r.substring(i.length,r.length)}return null}remove(t){document.cookie=t+"=; Max-Age=-99999999;"}lsSupport(){return!!window.localStorage}setLS(t,i){return this.lsSupport()&&localStorage.setItem(t,i)}getLS(t){return this.lsSupport()?localStorage.getItem(t):null}duration(t){var i=1,e="Fri, 31 Dec 1999 23:59:59 GMT";if(t)if(501==t)e="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==t)e=0;else{500==t?i=365:t>0&&t<=90&&(i=t);var n=new Date;1!=i&&(i-=1,n.setTime(n.getTime()+24*i*60*60*1e3)),n.setHours(23,59,59,0),e=n}return e}}function T(t,i){var e=(65535&t)+(65535&i);return(t>>16)+(i>>16)+(e>>16)<<16|65535&e}function D(t,i,e,n,r,s){return T((o=T(T(i,t),T(n,s)))<<(a=r)|o>>>32-a,e);var o,a}function E(t,i,e,n,r,s,o){return D(i&e|~i&n,t,i,r,s,o)}function M(t,i,e,n,r,s,o){return D(i&n|e&~n,t,i,r,s,o)}function A(t,i,e,n,r,s,o){return D(i^e^n,t,i,r,s,o)}function I(t,i,e,n,r,s,o){return D(e^(i|~n),t,i,r,s,o)}function _(t,i){var e,n,r,s,o;t[i>>5]|=128<<i%32,t[14+(i+64>>>9<<4)]=i;var a=1732584193,h=-271733879,u=-1732584194,c=271733878;for(e=0;e<t.length;e+=16)n=a,r=h,s=u,o=c,a=E(a,h,u,c,t[e],7,-680876936),c=E(c,a,h,u,t[e+1],12,-389564586),u=E(u,c,a,h,t[e+2],17,606105819),h=E(h,u,c,a,t[e+3],22,-1044525330),a=E(a,h,u,c,t[e+4],7,-176418897),c=E(c,a,h,u,t[e+5],12,1200080426),u=E(u,c,a,h,t[e+6],17,-1473231341),h=E(h,u,c,a,t[e+7],22,-45705983),a=E(a,h,u,c,t[e+8],7,1770035416),c=E(c,a,h,u,t[e+9],12,-1958414417),u=E(u,c,a,h,t[e+10],17,-42063),h=E(h,u,c,a,t[e+11],22,-1990404162),a=E(a,h,u,c,t[e+12],7,1804603682),c=E(c,a,h,u,t[e+13],12,-40341101),u=E(u,c,a,h,t[e+14],17,-1502002290),a=M(a,h=E(h,u,c,a,t[e+15],22,1236535329),u,c,t[e+1],5,-165796510),c=M(c,a,h,u,t[e+6],9,-1069501632),u=M(u,c,a,h,t[e+11],14,643717713),h=M(h,u,c,a,t[e],20,-373897302),a=M(a,h,u,c,t[e+5],5,-701558691),c=M(c,a,h,u,t[e+10],9,38016083),u=M(u,c,a,h,t[e+15],14,-660478335),h=M(h,u,c,a,t[e+4],20,-405537848),a=M(a,h,u,c,t[e+9],5,568446438),c=M(c,a,h,u,t[e+14],9,-1019803690),u=M(u,c,a,h,t[e+3],14,-187363961),h=M(h,u,c,a,t[e+8],20,1163531501),a=M(a,h,u,c,t[e+13],5,-1444681467),c=M(c,a,h,u,t[e+2],9,-51403784),u=M(u,c,a,h,t[e+7],14,1735328473),a=A(a,h=M(h,u,c,a,t[e+12],20,-1926607734),u,c,t[e+5],4,-378558),c=A(c,a,h,u,t[e+8],11,-2022574463),u=A(u,c,a,h,t[e+11],16,1839030562),h=A(h,u,c,a,t[e+14],23,-35309556),a=A(a,h,u,c,t[e+1],4,-1530992060),c=A(c,a,h,u,t[e+4],11,1272893353),u=A(u,c,a,h,t[e+7],16,-155497632),h=A(h,u,c,a,t[e+10],23,-1094730640),a=A(a,h,u,c,t[e+13],4,681279174),c=A(c,a,h,u,t[e],11,-358537222),u=A(u,c,a,h,t[e+3],16,-722521979),h=A(h,u,c,a,t[e+6],23,76029189),a=A(a,h,u,c,t[e+9],4,-640364487),c=A(c,a,h,u,t[e+12],11,-421815835),u=A(u,c,a,h,t[e+15],16,530742520),a=I(a,h=A(h,u,c,a,t[e+2],23,-995338651),u,c,t[e],6,-198630844),c=I(c,a,h,u,t[e+7],10,1126891415),u=I(u,c,a,h,t[e+14],15,-1416354905),h=I(h,u,c,a,t[e+5],21,-57434055),a=I(a,h,u,c,t[e+12],6,1700485571),c=I(c,a,h,u,t[e+3],10,-1894986606),u=I(u,c,a,h,t[e+10],15,-1051523),h=I(h,u,c,a,t[e+1],21,-2054922799),a=I(a,h,u,c,t[e+8],6,1873313359),c=I(c,a,h,u,t[e+15],10,-30611744),u=I(u,c,a,h,t[e+6],15,-1560198380),h=I(h,u,c,a,t[e+13],21,1309151649),a=I(a,h,u,c,t[e+4],6,-145523070),c=I(c,a,h,u,t[e+11],10,-1120210379),u=I(u,c,a,h,t[e+2],15,718787259),h=I(h,u,c,a,t[e+9],21,-343485551),a=T(a,n),h=T(h,r),u=T(u,s),c=T(c,o);return[a,h,u,c]}function N(t){var i,e="",n=32*t.length;for(i=0;i<n;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e}function j(t){var i,e=[];for(e[(t.length>>2)-1]=void 0,i=0;i<e.length;i+=1)e[i]=0;var n=8*t.length;for(i=0;i<n;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e}function P(t){var i,e,n="";for(e=0;e<t.length;e+=1)i=t.charCodeAt(e),n+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return n}function q(t){return unescape(encodeURIComponent(t))}function C(t){return function(t){return N(_(j(t),8*t.length))}(q(t))}function U(t,i){return function(t,i){var e,n,r=j(t),s=[],o=[];for(s[15]=o[15]=void 0,r.length>16&&(r=_(r,8*t.length)),e=0;e<16;e+=1)s[e]=909522486^r[e],o[e]=1549556828^r[e];return n=_(s.concat(j(i)),512+8*i.length),N(_(o.concat(n),640))}(q(t),q(i))}function R(t,i,e){return i?e?U(i,t):P(U(i,t)):e?C(t):P(C(t))}var L,x={suppressedNode:t=>{for(var i={},e=0;e<t.attributes.length;e++){var n=x.suppressedNodeAttribute(t,t.attributes[e]);n&&(i[n.name]=n.value)}return{node:{tagName:t.tagName,attributes:i||{}}}},suppressedNodeAttribute:(t,i)=>{var{name:e}=i,{value:n}=i;return"nv"!==e.slice(0,2)&&("IMG"!==t.tagName||"src"!==t.tagName&&"style"!==t.tagName)&&x.isAttributeSuppressable(t.tagName,e,n,t.attributes)&&(n=x.suppressedText(n,"full")),{name:e,value:n}},isAttributeSuppressable:(t,i,e,n)=>{var r,s={INPUT:{attrs:["value"]},TEXTAREA:{attrs:["value"]},A:{attrs:["href"],shouldSuppressAttrValueCheck:t=>!t.match(/^data:/)},OPTION:{attrs:["label","value"]},PROGRESS:{attrs:["value"]},OPTGROUP:{attrs:["label"]},IMG:{attrs:["alt"]},DIV:{attrs:["title"]},META:(t,i,e)=>{switch(t){case"content":return!(e.name&&("viewport"===e.name.value||e["http-equiv"])&&x.metaAttr(e));case"name":return"viewport"!==i;case"http-equiv":return!x.metaAttr(e);case"charset":return!1;default:return!0}}}[t];if(void 0===s)r=!1;else{if("function"==typeof s)return s(i,e,n);r=!(s.attrs.indexOf(i)<0)&&(void 0===s.shouldSuppressAttrValueCheck||s.shouldSuppressAttrValueCheck(e))}return r},suppressedText:(t,i)=>{var e=t;if("string"==typeof e)switch(i){case"full":e=e.replace(/[a-zA-Z0-9]/g,"*");break;case"partial":e=(e=x.suppressedEmail(e)).replace(/\d/g,"*")}return e},suppressedEmail:t=>{var i=t,e=i.match(/\S+[a-z0-9]@[a-z0-9\.]+/gim);if(Array.isArray(e)&&e.length>0){var n=t=>{-1!==(i=i.replace(t,t.replace(/[A-Za-z]/g,"*"))).indexOf(t)&&n(t)};e.forEach(t=>{n(t)})}return i},checkParent:t=>{var i=!0;return t&&t.tagName&&["style","script"].includes(t.tagName.toLowerCase())&&(i=!1),i},suppressedTextNode:t=>{var i=x.checkParent(t.parentNode),e=t.textContent;return i&&"string"==typeof e?x.suppressedText(e,"partial"):e},encodeAsUtf8:t=>unescape(encodeURIComponent(t)),b64EncodeUnicode:t=>window.btoa(x.encodeAsUtf8(t)),metaAttr:t=>{var i=t["http-equiv"]?t["http-equiv"].value:null,e=!0;return i&&(e=["default-style","content-type","refresh"].some(t=>!!i.match(t))),e}};if(void 0===(L="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver))throw console.error("DOM Mutation Observers are required."),console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver"),Error("DOM Mutation Observers are required");var H,z=function(){function t(){this.nodes=[],this.values=[]}return t.prototype.isIndex=function(t){return+t==t>>>0},t.prototype.nodeId=function(i){var e=i[t.ID_PROP];return e||(e=i[t.ID_PROP]=t.nextId_++),e},t.prototype.set=function(t,i){var e=this.nodeId(t);this.nodes[e]=t,this.values[e]=i},t.prototype.get=function(t){var i=this.nodeId(t);return this.values[i]},t.prototype.has=function(t){return this.nodeId(t)in this.nodes},t.prototype.delete=function(t){var i=this.nodeId(t);delete this.nodes[i],this.values[i]=void 0},t.prototype.keys=function(){var t=[];for(var i in this.nodes)this.isIndex(i)&&t.push(this.nodes[i]);return t},t.ID_PROP="__mutation_summary_node_map_id__",t.nextId_=1,t}();!function(t){t[t.STAYED_OUT=0]="STAYED_OUT",t[t.ENTERED=1]="ENTERED",t[t.STAYED_IN=2]="STAYED_IN",t[t.REPARENTED=3]="REPARENTED",t[t.REORDERED=4]="REORDERED",t[t.EXITED=5]="EXITED"}(H||(H={}));var J=function(){function t(t,i,e,n,r,s,o,a){void 0===i&&(i=!1),void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===r&&(r=null),void 0===s&&(s=!1),void 0===o&&(o=null),void 0===a&&(a=null),this.node=t,this.childList=i,this.attributes=e,this.characterData=n,this.oldParentNode=r,this.added=s,this.attributeOldValues=o,this.characterDataOldValue=a,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}return t.prototype.getAttributeOldValue=function(t){if(this.attributeOldValues)return this.isCaseInsensitive&&(t=t.toLowerCase()),this.attributeOldValues[t]},t.prototype.getAttributeNamesMutated=function(){var t=[];if(!this.attributeOldValues)return t;for(var i in this.attributeOldValues)t.push(i);return t},t.prototype.attributeMutated=function(t,i){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},t in this.attributeOldValues||(this.attributeOldValues[t]=i)},t.prototype.characterDataMutated=function(t){this.characterData||(this.characterData=!0,this.characterDataOldValue=t)},t.prototype.removedFromParent=function(t){this.childList=!0,this.added||this.oldParentNode?this.added=!1:this.oldParentNode=t},t.prototype.insertedIntoParent=function(){this.childList=!0,this.added=!0},t.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode},t}(),W=function(){this.added=new z,this.removed=new z,this.maybeMoved=new z,this.oldPrevious=new z,this.moved=void 0},B=function(t){function i(i,e){t.call(this),this.rootNode=i,this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(var n=0;n<e.length;n++){var r=e[n];switch(r.type){case"childList":this.anyParentsChanged=!0;for(var s=0;s<r.removedNodes.length;s++){var o=r.removedNodes[s];this.getChange(o).removedFromParent(r.target)}for(s=0;s<r.addedNodes.length;s++){o=r.addedNodes[s];this.getChange(o).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=!0,this.getChange(r.target).attributeMutated(r.attributeName,r.oldValue);break;case"characterData":this.anyCharacterDataChanged=!0,this.getChange(r.target).characterDataMutated(r.oldValue)}}}return function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);function n(){this.constructor=t}n.prototype=i.prototype,t.prototype=new n}(i,t),i.prototype.getChange=function(t){var i=this.get(t);return i||(i=new J(t),this.set(t,i)),i},i.prototype.getOldParent=function(t){var i=this.get(t);return i?i.getOldParent():t.parentNode},i.prototype.getIsReachable=function(t){if(t===this.rootNode)return!0;if(!t)return!1;this.reachableCache=this.reachableCache||new z;var i=this.reachableCache.get(t);return void 0===i&&(i=this.getIsReachable(t.parentNode),this.reachableCache.set(t,i)),i},i.prototype.getWasReachable=function(t){if(t===this.rootNode)return!0;if(!t)return!1;this.wasReachableCache=this.wasReachableCache||new z;var i=this.wasReachableCache.get(t);return void 0===i&&(i=this.getWasReachable(this.getOldParent(t)),this.wasReachableCache.set(t,i)),i},i.prototype.reachabilityChange=function(t){return this.getIsReachable(t)?this.getWasReachable(t)?H.STAYED_IN:H.ENTERED:this.getWasReachable(t)?H.EXITED:H.STAYED_OUT},i}(z),F=function(){function t(t,i,e,n,r){this.rootNode=t,this.mutations=i,this.selectors=e,this.calcReordered=n,this.calcOldPreviousSibling=r,this.treeChanges=new B(t,i),this.entered=[],this.exited=[],this.stayedIn=new z,this.visited=new z,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}return t.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var t=this.treeChanges.keys(),i=0;i<t.length;i++)this.visitNode(t[i],void 0)},t.prototype.visitNode=function(t,i){if(!this.visited.has(t)){this.visited.set(t,!0);var e=this.treeChanges.get(t),n=i;if((e&&e.childList||null==n)&&(n=this.treeChanges.reachabilityChange(t)),n!==H.STAYED_OUT){if(this.matchabilityChange(t),n===H.ENTERED)this.entered.push(t);else if(n===H.EXITED)this.exited.push(t),this.ensureHasOldPreviousSiblingIfNeeded(t);else if(n===H.STAYED_IN){var r=H.STAYED_IN;e&&e.childList&&(e.oldParentNode!==t.parentNode?(r=H.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(t)):this.calcReordered&&this.wasReordered(t)&&(r=H.REORDERED)),this.stayedIn.set(t,r)}if(n!==H.STAYED_IN)for(var s=t.firstChild;s;s=s.nextSibling)this.visitNode(s,n)}}},t.prototype.ensureHasOldPreviousSiblingIfNeeded=function(t){if(this.calcOldPreviousSibling){this.processChildlistChanges();var i=t.parentNode,e=this.treeChanges.get(t);e&&e.oldParentNode&&(i=e.oldParentNode);var n=this.childListChangeMap.get(i);n||(n=new W,this.childListChangeMap.set(i,n)),n.oldPrevious.has(t)||n.oldPrevious.set(t,t.previousSibling)}},t.prototype.getChanged=function(t,i,e){this.selectors=i,this.characterDataOnly=e;for(var n=0;n<this.entered.length;n++){var r=this.entered[n];(a=this.matchabilityChange(r))!==H.ENTERED&&a!==H.STAYED_IN||t.added.push(r)}var s=this.stayedIn.keys();for(n=0;n<s.length;n++){r=s[n];if((a=this.matchabilityChange(r))===H.ENTERED)t.added.push(r);else if(a===H.EXITED)t.removed.push(r);else if(a===H.STAYED_IN&&(t.reparented||t.reordered)){var o=this.stayedIn.get(r);t.reparented&&o===H.REPARENTED?t.reparented.push(r):t.reordered&&o===H.REORDERED&&t.reordered.push(r)}}for(n=0;n<this.exited.length;n++){var a;r=this.exited[n];(a=this.matchabilityChange(r))!==H.EXITED&&a!==H.STAYED_IN||t.removed.push(r)}},t.prototype.getOldParentNode=function(t){var i=this.treeChanges.get(t);if(i&&i.childList)return i.oldParentNode?i.oldParentNode:null;var e=this.treeChanges.reachabilityChange(t);if(e===H.STAYED_OUT||e===H.ENTERED)throw Error("getOldParentNode requested on invalid node.");return t.parentNode},t.prototype.getOldPreviousSibling=function(t){var i=t.parentNode,e=this.treeChanges.get(t);e&&e.oldParentNode&&(i=e.oldParentNode);var n=this.childListChangeMap.get(i);if(!n)throw Error("getOldPreviousSibling requested on invalid node.");return n.oldPrevious.get(t)},t.prototype.getOldAttribute=function(t,i){var e=this.treeChanges.get(t);if(!e||!e.attributes)throw Error("getOldAttribute requested on invalid node.");var n=e.getAttributeOldValue(i);if(void 0===n)throw Error("getOldAttribute requested for unchanged attribute name.");return n},t.prototype.attributeChangedNodes=function(t){if(!this.treeChanges.anyAttributesChanged)return{};var i,e;if(t){i={},e={};for(var n=0;n<t.length;n++){i[f=t[n]]=!0,e[f.toLowerCase()]=f}}var r={},s=this.treeChanges.keys();for(n=0;n<s.length;n++){var o=s[n],a=this.treeChanges.get(o);if(a.attributes&&(H.STAYED_IN===this.treeChanges.reachabilityChange(o)&&H.STAYED_IN===this.matchabilityChange(o)))for(var h=o,u=a.getAttributeNamesMutated(),c=0;c<u.length;c++){var f=u[c];if(!i||i[f]||a.isCaseInsensitive&&e[f])a.getAttributeOldValue(f)!==h.getAttribute(f)&&(e&&a.isCaseInsensitive&&(f=e[f]),r[f]=r[f]||[],r[f].push(h))}}return r},t.prototype.getOldCharacterData=function(t){var i=this.treeChanges.get(t);if(!i||!i.characterData)throw Error("getOldCharacterData requested on invalid node.");return i.characterDataOldValue},t.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var t=this.treeChanges.keys(),i=[],e=0;e<t.length;e++){var n=t[e];if(H.STAYED_IN===this.treeChanges.reachabilityChange(n)){var r=this.treeChanges.get(n);r.characterData&&n.textContent!=r.characterDataOldValue&&i.push(n)}}return i},t.prototype.computeMatchabilityChange=function(t,i){this.matchCache||(this.matchCache=[]),this.matchCache[t.uid]||(this.matchCache[t.uid]=new z);var e=this.matchCache[t.uid],n=e.get(i);return void 0===n&&(n=t.matchabilityChange(i,this.treeChanges.get(i)),e.set(i,n)),n},t.prototype.matchabilityChange=function(t){var i=this;if(this.characterDataOnly)switch(t.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return H.STAYED_IN;default:return H.STAYED_OUT}if(!this.selectors)return H.STAYED_IN;if(t.nodeType!==Node.ELEMENT_NODE)return H.STAYED_OUT;for(var e=t,n=this.selectors.map(function(t){return i.computeMatchabilityChange(t,e)}),r=H.STAYED_OUT,s=0;r!==H.STAYED_IN&&s<n.length;){switch(n[s]){case H.STAYED_IN:r=H.STAYED_IN;break;case H.ENTERED:r=r===H.EXITED?H.STAYED_IN:H.ENTERED;break;case H.EXITED:r=r===H.ENTERED?H.STAYED_IN:H.EXITED}s++}return r},t.prototype.getChildlistChange=function(t){var i=this.childListChangeMap.get(t);return i||(i=new W,this.childListChangeMap.set(t,i)),i},t.prototype.processChildlistChanges=function(){if(!this.childListChangeMap){this.childListChangeMap=new z;for(var t=0;t<this.mutations.length;t++){var i=this.mutations[t];if("childList"==i.type&&(this.treeChanges.reachabilityChange(i.target)===H.STAYED_IN||this.calcOldPreviousSibling)){for(var e=this.getChildlistChange(i.target),n=i.previousSibling,r=0;r<i.removedNodes.length;r++){o(s=i.removedNodes[r],n),e.added.has(s)?e.added.delete(s):(e.removed.set(s,!0),e.maybeMoved.delete(s)),n=s}o(i.nextSibling,n);for(r=0;r<i.addedNodes.length;r++){var s=i.addedNodes[r];e.removed.has(s)?(e.removed.delete(s),e.maybeMoved.set(s,!0)):e.added.set(s,!0)}}function o(t,i){!t||e.oldPrevious.has(t)||e.added.has(t)||e.maybeMoved.has(t)||i&&(e.added.has(i)||e.maybeMoved.has(i))||e.oldPrevious.set(t,i)}}}},t.prototype.wasReordered=function(t){if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var i=t.parentNode,e=this.treeChanges.get(t);e&&e.oldParentNode&&(i=e.oldParentNode);var n=this.childListChangeMap.get(i);if(!n)return!1;if(n.moved)return n.moved.get(t);n.moved=new z;var r=new z;function s(t){if(!t)return!1;if(!n.maybeMoved.has(t))return!1;var i=n.moved.get(t);return void 0!==i?i:(r.has(t)?i=!0:(r.set(t,!0),i=function(t){if(a.has(t))return a.get(t);var i=t.previousSibling;for(;i&&(n.added.has(i)||s(i));)i=i.previousSibling;return a.set(t,i),i}(t)!==function t(i){var e=o.get(i);if(void 0!==e)return e;e=n.oldPrevious.get(i);for(;e&&(n.removed.has(e)||s(e));)e=t(e);void 0===e&&(e=i.previousSibling);o.set(i,e);return e}(t)),r.has(t)?(r.delete(t),n.moved.set(t,i)):i=n.moved.get(t),i)}var o=new z;var a=new z;return n.maybeMoved.keys().forEach(s),n.moved.get(t)},t}(),K=function(){function t(t,i){var e=this;if(this.projection=t,this.added=[],this.removed=[],this.reparented=i.all||i.element||i.characterData?[]:void 0,this.reordered=i.all?[]:void 0,t.getChanged(this,i.elementFilter,i.characterData),i.all||i.attribute||i.attributeList){var n=i.attribute?[i.attribute]:i.attributeList,r=t.attributeChangedNodes(n);i.attribute?this.valueChanged=r[i.attribute]||[]:(this.attributeChanged=r,i.attributeList&&i.attributeList.forEach(function(t){e.attributeChanged.hasOwnProperty(t)||(e.attributeChanged[t]=[])}))}if(i.all||i.characterData){var s=t.getCharacterDataChanged();i.characterData?this.valueChanged=s:this.characterDataChanged=s}this.reordered&&(this.getOldPreviousSibling=t.getOldPreviousSibling.bind(t))}return t.prototype.getOldParentNode=function(t){return this.projection.getOldParentNode(t)},t.prototype.getOldAttribute=function(t,i){return this.projection.getOldAttribute(t,i)},t.prototype.getOldCharacterData=function(t){return this.projection.getOldCharacterData(t)},t.prototype.getOldPreviousSibling=function(t){return this.projection.getOldPreviousSibling(t)},t}(),G=/[a-zA-Z_]+/,V=/[a-zA-Z0-9_\-]+/;function X(t){return'"'+t.replace(/"/,'\\"')+'"'}var Z=function(){function t(){}return t.prototype.matches=function(t){if(null===t)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==t;for(var i=t.split(" "),e=0;e<i.length;e++)if(this.attrValue===i[e])return!0;return!1},t.prototype.toString=function(){return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+X(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+X(this.attrValue)+"]":"["+this.attrName+"]":"#"+this.attrValue},t}(),Y=function(){function t(){this.uid=t.nextUid++,this.qualifiers=[]}var i;return Object.defineProperty(t.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0}),t.prototype.isMatching=function(i){return i[t.matchesSelector](this.selectorString)},t.prototype.wasMatching=function(t,i,e){if(!i||!i.attributes)return e;var n=i.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==n&&n!==t.tagName)return!1;for(var r=[],s=!1,o=0;o<this.qualifiers.length;o++){var a=this.qualifiers[o],h=i.getAttributeOldValue(a.attrName);r.push(h),s=s||void 0!==h}if(!s)return e;for(o=0;o<this.qualifiers.length;o++){a=this.qualifiers[o];if(void 0===(h=r[o])&&(h=t.getAttribute(a.attrName)),!a.matches(h))return!1}return!0},t.prototype.matchabilityChange=function(t,i){var e=this.isMatching(t);return e?this.wasMatching(t,i,e)?H.STAYED_IN:H.ENTERED:this.wasMatching(t,i,e)?H.EXITED:H.STAYED_OUT},t.parseSelectors=function(i){var e,n,r=[];function s(){e&&(n&&(e.qualifiers.push(n),n=void 0),r.push(e)),e=new t}function o(){n&&e.qualifiers.push(n),n=new Z}for(var a,h=/\s/,u="Invalid or unsupported selector syntax.",c=1,f=0;f<i.length;){var d=i[f++];switch(c){case 1:if(d.match(G)){s(),e.tagName=d,c=2;break}if("*"==d){s(),e.tagName="*",c=3;break}if("."==d){s(),o(),e.tagName="*",n.attrName="class",n.contains=!0,c=4;break}if("#"==d){s(),o(),e.tagName="*",n.attrName="id",c=4;break}if("["==d){s(),o(),e.tagName="*",n.attrName="",c=6;break}if(d.match(h))break;throw Error(u);case 2:if(d.match(V)){e.tagName+=d;break}if("."==d){o(),n.attrName="class",n.contains=!0,c=4;break}if("#"==d){o(),n.attrName="id",c=4;break}if("["==d){o(),n.attrName="",c=6;break}if(d.match(h)){c=14;break}if(","==d){c=1;break}throw Error(u);case 3:if("."==d){o(),n.attrName="class",n.contains=!0,c=4;break}if("#"==d){o(),n.attrName="id",c=4;break}if("["==d){o(),n.attrName="",c=6;break}if(d.match(h)){c=14;break}if(","==d){c=1;break}throw Error(u);case 4:if(d.match(G)){n.attrValue=d,c=5;break}throw Error(u);case 5:if(d.match(V)){n.attrValue+=d;break}if("."==d){o(),n.attrName="class",n.contains=!0,c=4;break}if("#"==d){o(),n.attrName="id",c=4;break}if("["==d){o(),c=6;break}if(d.match(h)){c=14;break}if(","==d){c=1;break}throw Error(u);case 6:if(d.match(G)){n.attrName=d,c=7;break}if(d.match(h))break;throw Error(u);case 7:if(d.match(V)){n.attrName+=d;break}if(d.match(h)){c=8;break}if("~"==d){n.contains=!0,c=9;break}if("="==d){n.attrValue="",c=11;break}if("]"==d){c=3;break}throw Error(u);case 8:if("~"==d){n.contains=!0,c=9;break}if("="==d){n.attrValue="",c=11;break}if("]"==d){c=3;break}if(d.match(h))break;throw Error(u);case 9:if("="==d){n.attrValue="",c=11;break}throw Error(u);case 10:if("]"==d){c=3;break}if(d.match(h))break;throw Error(u);case 11:if(d.match(h))break;if('"'==d||"'"==d){a=d,c=13;break}n.attrValue+=d,c=12;break;case 12:if(d.match(h)){c=10;break}if("]"==d){c=3;break}if("'"==d||'"'==d)throw Error(u);n.attrValue+=d;break;case 13:if(d==a){c=10;break}n.attrValue+=d;break;case 14:if(d.match(h))break;if(","==d){c=1;break}throw Error(u)}}switch(c){case 1:case 2:case 3:case 5:case 14:s();break;default:throw Error(u)}if(!r.length)throw Error(u);return r},t.nextUid=1,t.matchesSelector="function"==typeof(i=document.createElement("div")).webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof i.mozMatchesSelector?"mozMatchesSelector":"function"==typeof i.msMatchesSelector?"msMatchesSelector":"matchesSelector",t}(),$=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function Q(t){if("string"!=typeof t)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!(t=t.trim()))throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!t.match($))throw Error("Invalid request option. invalid attribute name: "+t);return t}function tt(t){if(!t.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var i={},e={},n=t.split(/\s+/),r=0;r<n.length;r++){if(s=n[r]){var s,o=(s=Q(s)).toLowerCase();if(i[o])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");e[s]=!0,i[o]=!0}}return Object.keys(e)}var it=function(){function t(i){var e=this;this.connected=!1,this.options=t.validateOptions(i),this.observerOptions=t.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(t){return t.elementFilter?t.elementFilter:[]})),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(function(t){return t.all}),this.queryValidators=[],t.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(i){return t.createQueryValidator(e.root,i)})),this.observer=new L(function(t){e.observerCallback(t)}),this.reconnect()}return t.createObserverOptions=function(t){var i,e={childList:!0,subtree:!0};function n(t){e.attributes&&!i||(e.attributes=!0,e.attributeOldValue=!0,t?(i=i||{},t.forEach(function(t){i[t]=!0,i[t.toLowerCase()]=!0})):i=void 0)}return t.forEach(function(t){if(t.characterData)return e.characterData=!0,void(e.characterDataOldValue=!0);if(t.all)return n(),e.characterData=!0,void(e.characterDataOldValue=!0);if(t.attribute)n([t.attribute.trim()]);else{var i=function(t){var i={};return t.forEach(function(t){t.qualifiers.forEach(function(t){i[t.attrName]=!0})}),Object.keys(i)}(t.elementFilter).concat(t.attributeList||[]);i.length&&n(i)}}),i&&(e.attributeFilter=Object.keys(i)),e},t.validateOptions=function(i){for(var e in i)if(!(e in t.optionKeys))throw Error("Invalid option: "+e);if("function"!=typeof i.callback)throw Error("Invalid options: callback is required and must be a function");if(!i.queries||!i.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");for(var n={callback:i.callback,rootNode:i.rootNode||document,observeOwnChanges:!!i.observeOwnChanges,oldPreviousSibling:!!i.oldPreviousSibling,queries:[]},r=0;r<i.queries.length;r++){var s=i.queries[r];if(s.all){if(Object.keys(s).length>1)throw Error("Invalid request option. all has no options.");n.queries.push({all:!0})}else if("attribute"in s){if((a={attribute:Q(s.attribute)}).elementFilter=Y.parseSelectors("*["+a.attribute+"]"),Object.keys(s).length>1)throw Error("Invalid request option. attribute has no options.");n.queries.push(a)}else if("element"in s){var o=Object.keys(s).length,a={element:s.element,elementFilter:Y.parseSelectors(s.element)};if(s.hasOwnProperty("elementAttributes")&&(a.attributeList=tt(s.elementAttributes),o--),o>1)throw Error("Invalid request option. element only allows elementAttributes option.");n.queries.push(a)}else{if(!s.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(s).length>1)throw Error("Invalid request option. characterData has no options.");n.queries.push({characterData:!0})}}return n},t.prototype.createSummaries=function(t){if(!t||!t.length)return[];for(var i=new F(this.root,t,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling),e=[],n=0;n<this.options.queries.length;n++)e.push(new K(i,this.options.queries[n]));return e},t.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(t){t&&t.recordPreviousState()})},t.prototype.runQueryValidators=function(t){this.queryValidators.forEach(function(i,e){i&&i.validate(t[e])})},t.prototype.changesToReport=function(t){return t.some(function(t){if(["added","removed","reordered","reparented","valueChanged","characterDataChanged"].some(function(i){return t[i]&&t[i].length}))return!0;if(t.attributeChanged&&Object.keys(t.attributeChanged).some(function(i){return!!t.attributeChanged[i].length}))return!0;return!1})},t.prototype.observerCallback=function(t){this.options.observeOwnChanges||this.observer.disconnect();var i=this.createSummaries(t);this.runQueryValidators(i),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(i)&&this.callback(i),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))},t.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators()},t.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var t=this.createSummaries(this.observer.takeRecords());return this.changesToReport(t)?t:void 0},t.prototype.disconnect=function(){var t=this.takeSummaries();return this.observer.disconnect(),this.connected=!1,t},t.NodeMap=z,t.parseElementFilter=Y.parseSelectors,t.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0},t}(),et=function(){function t(t,i,e){var n=this;this.target=t,this.mirror=i,this.nextId=1,this.knownNodes=new it.NodeMap,void 0===this.mirror&&(this.mirror=n.getDefaultMirror());for(var r=this.serializeNode(t).id,s=[],o=t.firstChild;o;o=o.nextSibling)s.push(this.serializeNode(o,!0));this.mirror.initialize(r,s);var a,h=[{all:!0}];e&&(h=h.concat(e));try{a="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver}catch(t){a=void 0}void 0!==a&&(this.mutationSummary=new it({rootNode:t,callback:function(t){n.applyChanged(t)},queries:h}))}return t.prototype.getDefaultMirror=function(){return{initialize:function(t,i){},applyChanged:function(t,i,e,n){}}},t.prototype.disconnect=function(){this.mutationSummary&&(this.mutationSummary.disconnect(),this.mutationSummary=void 0)},t.prototype.rememberNode=function(t){var i=this.nextId++;return this.knownNodes.set(t,i),i},t.prototype.forgetNode=function(t){this.knownNodes.delete(t)},t.prototype.serializeNode=function(t,i){if(null===t)return null;var e=this.knownNodes.get(t);if(void 0!==e)return{id:e};var n={nodeType:t.nodeType,id:this.rememberNode(t)};switch(n.nodeType){case Node.DOCUMENT_TYPE_NODE:var r=t;n.name=r.name,n.publicId=r.publicId,n.systemId=r.systemId;break;case Node.COMMENT_NODE:case Node.TEXT_NODE:n.textContent=x.suppressedTextNode(t);break;case Node.ELEMENT_NODE:var s=t,o=x.suppressedNode(t);if(n.tagName=o.node.tagName,n.attributes=o.node.attributes,i&&s.childNodes.length){n.childNodes=[];for(var a=s.firstChild;a;a=a.nextSibling)n.childNodes.push(this.serializeNode(a,!0))}}return n},t.prototype.serializeAddedAndMoved=function(t,i,e){var n=this,r=t.concat(i).concat(e),s=new it.NodeMap;r.forEach(function(t){var i=t.parentNode,e=s.get(i);e||(e=new it.NodeMap,s.set(i,e)),e.set(t,!0)});var o=[];return s.keys().forEach(function(t){for(var i=s.get(t),e=i.keys();e.length;){for(var r=e[0];r.previousSibling&&i.has(r.previousSibling);)r=r.previousSibling;for(;r&&i.has(r);){var a=n.serializeNode(r);a.previousSibling=n.serializeNode(r.previousSibling),a.parentNode=n.serializeNode(r.parentNode),o.push(a),i.delete(r),r=r.nextSibling}e=i.keys()}}),o},t.prototype.serializeAttributeChanges=function(t){var i=this,e=new it.NodeMap;return Object.keys(t).forEach(function(n){t[n].forEach(function(t){var r=e.get(t);r||((r=i.serializeNode(t)).attributes={},e.set(t,r)),r.attributes[n]=t.getAttribute(n)})}),e.keys().map(function(t){return e.get(t)})},t.prototype.applyChanged=function(t){var i=this,e=t[0],n=e.removed.map(function(t){return i.serializeNode(t)}),r=this.serializeAddedAndMoved(e.added,e.reparented,e.reordered),s=this.serializeAttributeChanges(e.attributeChanged),o=e.characterDataChanged.map(function(t){var e=i.serializeNode(t);return e.textContent=t.textContent,e});this.mirror.applyChanged(n,r,s,o),e.removed.forEach(function(t){i.forgetNode(t)})},t}(),nt=function(){function t(){this.webResource=[],this.check={},this.mutation=[],this.formedTree="",this.tryCatch=function(t,i){return function(){try{return t.apply(this,arguments)}catch(t){console.log(t,i||"Generic")}}},this.getPageDoctype=function(){return this.tryCatch(function(){return null===document.doctype?"":"<!DOCTYPE "+(document.doctype.name||"html")+(document.doctype.publicId?' PUBLIC "'+document.doctype.publicId+'"':"")+(!document.doctype.publicId&&document.doctype.systemId?" SYSTEM":"")+(document.doctype.systemId?' "'+document.doctype.systemId+'"':"")+">\n"},"common")},this.getTree=function(t,i){return JSON.stringify({docType:this.getPageDoctype(),rootId:t,children:i})}}return t.prototype.getResource=function(t){var i=[];return Array.prototype.forEach.call(t.styleSheets,t=>{t&&t.href&&0===t.href.indexOf("https")&&i.push({url:t.href,url_hash:R(x.b64EncodeUnicode(t.href))})}),i},t.prototype.init=function(t,i){var e,n,r=this;r.time=(e={},n=(new Date).getTime(),e.reset=function(){n=(new Date).getTime()},e.getNow=function(){return(new Date).getTime()-n},e);new et(t,{initialize:function(t,i){r.formedTree=r.getTree(t,i)},applyChanged:function(t,i,e,n){var s={};if((i.length||e.length||t.length||n.length)&&(i.length&&(s.addedOrMoved=i),e.length&&(s.attributes=e),t.length&&(s.removed=t),n.length&&(s.text=n)),Object.keys(s).length){var o=[];o.push(s),r.mutation=r.mutation.concat(o)}}})},t.prototype.getStructure=function(){return this.formedTree},t.prototype.getWebResource=function(){return this.webResource},t.prototype.getMutation=function(){var t=this.mutation;return this.mutation=[],t},t}(),rt={},st={},ot=function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nv-websocket";rt[e]=new WebSocket(n.urls.awsWebSocketUrl),rt[e].onopen=t=>{rt[e].send(JSON.stringify({action:"handshake",data:"No Data"}))},rt[e].onmessage=i=>{try{var n=i.data?JSON.parse(i.data):{};"handshakeRoute"===n.name&&(rt[e].id=n.connectionId,at(),t(n.connectionId))}catch(t){console.log(t)}},rt[e].onconnectionSet=t=>{console.log(t)},rt[e].onclose=t=>{t.wasClean,st[e]=0},rt[e].onerror=t=>{}},at=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nv-websocket";st[t]=1},ht=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nv-websocket";return!!st[t]};var ut,ct,ft,dt,vt,lt,mt,wt,bt,pt,kt,gt,yt={init:ot,emit:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nv-websocket";i&&st[e]&&("disconnectSocket"===i?rt[e].close():rt[e].send(JSON.stringify({action:i,data:t})))},setDisconnect:at,getDisconnect:ht,checkConnection:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nv-websocket";ht()?t(rt[e].id):ot(t,i)},checkSocketConnection:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nv-websocket";return!(!rt[t]||!rt[t].id)},getConnectedWebSocket:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nv-websocket";return rt[t]}},Ot=0,St=0;class Tt{constructor(){this.points=[],this.movePoints=[],this.scrollData=[],this.lastScroll=0,this.lastScrollPer=0,this.heatMap=!1,this.heatmapCamp="",this.pageUniqueKey=null,this.ipAddress="",this.altMethod="",this.device="",this.socket_id=null,this.clicks=this.clicks.bind(this),this.mflow=this.mflow.bind(this),this.scroll=this.scroll.bind(this),this.eachScrollData=this.eachScrollData.bind(this),this.setInitialValue=this.setInitialValue.bind(this),this.getHeatmapData=this.getHeatmapData.bind(this),this.resetdata=this.resetdata.bind(this),this.emitData=this.emitData.bind(this),this.sendHeatmapData=this.sendHeatmapData.bind(this),this.collectHmTime=this.collectHmTime.bind(this),this.sendLastScroll=this.sendLastScroll.bind(this),this.sendCommonData=this.sendCommonData.bind(this),this.setInitialValue()}setInitialValue(){ft=f(),ut=v(),vt=ut.getTimeOnCurrentPageInSeconds()}emitData(t,i){yt.getDisconnect()&&yt.emit(i,t)}collectHmTime(){return{activeTime:Math.abs(ut.getTimeOnCurrentPageInSeconds()).toFixed(3),timeOnPage:Math.abs((new Date-u())/1e3).toFixed(3)}}sendHeatmapData(t){this.socket_id=t,window.addEventListener("unload",this.sendLastScroll),setInterval(()=>{var t=this.getHeatmapData(),i=!1,e={};t&&Array.isArray(t.locData)&&t.locData.length&&(i=!0,e.clickData=t.locData,this.points=[]),t&&Array.isArray(t.moveData)&&t.moveData.length&&(i=!0,e.hoverData=t.moveData,this.movePoints=[]),t&&Array.isArray(t.scrollData)&&t.scrollData.length&&(i=!0,e.scrollData=t.scrollData,this.scrollData=[]),i&&(e.hmTime=this.collectHmTime(),e.connection_id=this.socket_id,e.connectionStatus="connected",e.pageUniqueKey=this.pageUniqueKey,this.emitData("heatmap-socket-time",e))},1e3)}sendCommonData(t){t&&this.emitData("heatmap-session-data",t)}sendLastScroll(){this.lastScrollPer&&(this.lastScrollPer=this.lastScrollPer<=100?this.lastScrollPer:100,this.emitData("heatmap-lastScroll",{connection_id:this.socket_id,connectionStatus:"connected",pageUniqueKey:this.pageUniqueKey,lastScroll:this.lastScrollPer}))}clicks(t){var i=l(t.target),e=t.target.offsetWidth,n=t.target.offsetHeight,r=new Date;if(e>0&&n>0){var s={xy:(Math.abs(t.pageX-i.left)/e).toFixed(3)+"-"+(Math.abs(t.pageY-i.top)/n).toFixed(4),clickedEl:b(t.target),ttc:r-u(),clickNum:++St};this.points.push(s)}}mflow(t){clearTimeout(ct),ct=setTimeout(function(i){if(document.body&&document.body.clientWidth){var e=(t.pageX/document.body.clientWidth).toFixed(3)+"-"+t.pageY;i.movePoints.push(e)}}.bind(null,this),500)}scroll(t){if(document.body&&document.documentElement){if(this.lastScroll<window.scrollY){var i=document.body,e=document.documentElement,n=Math.max(i.scrollHeight,i.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight);this.lastScroll=window.scrollY;var r=n>window.innerHeight?n-window.innerHeight:window.innerHeight;this.lastScrollPer=document.body.clientHeight?Math.round((this.lastScroll?this.lastScroll:0)/r*100):0}this.eachScrollData()}}eachScrollData(t){dt=new Date,lt=ut.getTimeOnCurrentPageInSeconds();var i={scr_i:Ot,et_f:Math.abs(lt-vt).toFixed(3),top_f:Math.abs((dt-ft)/1e3).toFixed(3)};i.top_f>1.01&&this.scrollData.push(i),Ot=document.body&&document.body.clientHeight?Math.round(window.scrollY/document.body.clientHeight*100):0,ft=dt,vt=lt}getHmCommanData(t){var{documentElement:i,body:e,referrer:n}=document,r=e?Math.max(e.scrollHeight,e.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight):0,s={brandID:window.notify_visitors.Optimize.data.brandID?window.notify_visitors.Optimize.data.brandID:"",domain:t.domain?t.domain:"",path:location.pathname?location.pathname:"",routingType:!!window.notify_visitors.routingType&&window.notify_visitors.routingType,pageheight:r||!1,pagewidth:!!e&&e.clientWidth,resolution:window.innerWidth+"x"+window.innerHeight,linkReferrer:n||!1,pageUrl:!!window.location.href&&window.location.href,userAgent:navigator.userAgent,ipAddress:this.ipAddress,pageUniqueKey:this.pageUniqueKey};return this.heatMap&&(s.heatMap=this.heatMap),this.heatmapCamp&&(s.heatmapCamp=this.heatmapCamp),this.altMethod&&(s.altMethod=this.altMethod),this.device&&(s.device=this.device),s}getHeatmapData(){return this.eachScrollData(),{locData:this.points,moveData:this.movePoints,scrollData:this.scrollData,heatmapCamp:this.heatmapCamp}}resetdata(){this.points=[],this.movePoints=[],this.lastScrollPer=0,this.lastScroll=0,this.scrollData=[],this.heatmapCamp="",ut.stopTimer(),ut.resetAllRecordedPageTimes()}}function Dt(){return mt||(mt=new Tt),mt}class Et{constructor(){this.formIntTime=[],this.formRefil=[],this.id_node=[],this.btn_node=[],this.lastTrack={},this.lastAttr="",this.lastBtn="",this.form_id="",this.field_name="",this.form_button="",this.field_id="",this.subBtn={},this.success={},this.failed={},this.formLeftBlank={},this.dropOf={},this.formInt={},this.form_timetocomplete="",this.formbtn=this.formbtn.bind(this),this.formFocus=this.formFocus.bind(this),this.formBlur=this.formBlur.bind(this),this.setInitialValue=this.setInitialValue.bind(this),this.getFormData=this.getFormData.bind(this),this.resetdata=this.resetdata.bind(this),this.setInitialValue()}setInitialValue(){}formbtn(t){var i=t.target.getAttribute("nvbtn");this.lastBtn=i,this.subBtn.hasOwnProperty(i)?this.subBtn[i]+=1:this.subBtn[i]=1}formFocus(t){wt=new Date;var i=t.target.id?t.target.id:t.target.name?t.target.name:"";if(this.formInt[i])return!1;var e=t.target.getAttribute("nvform");if(e){var n=e.split("-");this.formInt[i]={interactionTime:0,refil:-1,forms:n,correction:0,previousValue:null}}}formBlur(t){var i=new Date-wt,e=t.target.id?t.target.id:t.target.name?t.target.name:"",n=t.target.getAttribute("nvform");if(n){var r=n.split("-");if(this.formInt[e].previousValue&&this.formInt[e].previousValue!==t.target.value&&(this.formInt[e].correction+=1),this.formInt[e].previousValue=t.target.value,e)this.formInt[e].interactionTime+=i,this.formInt[e].refil+=1,t.target.value.length>=1?(this.formLeftBlank[e]&&this.formLeftBlank[e].formId&&delete this.formLeftBlank[e],this.dropOf[n]===e&&(this.dropOf[n]=""),this.lastTrack[n]=e,this.lastAttr=n):(this.formLeftBlank[e]||(this.formLeftBlank[e]={formId:[]}),0==this.formLeftBlank[e].formId.length&&(this.formLeftBlank[e].formId=r),this.dropOf[n]=e)}}getFormData(){return Object.keys(this.formInt).length<1?this.formLeftBlank={}:Object.keys(this.formInt).length>0&&Object.keys(this.lastTrack).length>0&&Object.keys(this.lastTrack).forEach(function(t){this.dropOf[t]=this.lastTrack[t];var i=document.getElementById(this.lastTrack[t]),e=this.id_node.indexOf(i),n=this.id_node[e+1];if(e+1<this.id_node.length&&n.value.length<1){var r=n.getAttribute("nvform");r===t&&(this.dropOf[r]=n.id)}},this),{formInt:this.formInt,formLeftBlank:this.formLeftBlank,dropOf:this.dropOf,form_id:this.form_id,subBtn:this.subBtn,success:this.success,failed:this.failed,form_timetocomplete:this.form_timetocomplete}}resetdata(){var t=Array.prototype.slice.call(document.querySelectorAll("[nvform]"));if(t.length)for(var i=0;i<t.length;i++)t[i].removeEventListener("focus",this.formFocus),t[i].removeEventListener("blur",this.formblur),t[i].removeAttribute("nvform");Array.prototype.slice.call(document.querySelectorAll("[nvbtn]"));if(t.length)for(i=0;i<t.length;i++)t[i].removeEventListener("click",this.formbtn),t[i].removeAttribute("nvbtn");this.formLeftBlank={},this.dropOf={},this.formInt={},this.form_id="",this.subBtn={},this.success={},this.failed={},this.form_timetocomplete=0}}function Mt(){return bt||(bt=new Et),bt}gt||(gt=new class{constructor(){this.oDomain="",this._CookieController=new S,this.windowObjName=window[e].Optimize.data,this.currentUser=[],this.recordingCamp="",this.heatmapCamp="",this.rec_camp_details="",this.restricted_fields=[],this.makeStructure=new nt,this.loadListner=this.loadListner.bind(this),this.saveData=this.saveData.bind(this),this.makeXMLRequest=this.makeXMLRequest.bind(this),this.sendUsingBeacon=this.sendUsingBeacon.bind(this),this.timeOnSite=this.timeOnSite.bind(this),this.resetdata=this.resetdata.bind(this)}loadListner(){kt=u(),pt=v()}saveData(t){var i=Mt(),e=new Date,n=document.body,r=document.documentElement,s=Math.max(n.scrollHeight,n.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight),o={brandID:this.windowObjName.auth.bid,domain:t&&t.oDomain?t.oDomain:this.windowObjName.domain,path:t&&t.url?t.url.pathname:location.pathname,hash:t&&t.url?t.url.hash:location.hash,routingType:t&&t.routeType?t.routeType:notify_visitors.routingType?notify_visitors.routingType:"",activeTime:Math.abs(pt.getTimeOnCurrentPageInSeconds()).toFixed(3),timeOnPage:Math.abs((e-kt)/1e3).toFixed(3),pageheight:t&&t.height?t.height:s,pagewidth:document.body.clientWidth,resolution:window.screen.width+"x"+window.screen.height,linkReferrer:document.referrer,pageUrl:t&&t.url?t.url.href:window.location.href,heatMap:this.windowObjName.heatMap};o=Object.assign(o,i.getFormData()),window.navigator.sendBeacon?this.sendUsingBeacon(o):this.makeXMLRequest(o),t&&t.oDomain&&this.resetdata()}makeXMLRequest(t){var i=new XMLHttpRequest;i.onreadystatechange=function(t){},i.open("POST",n.urls.heatmapData,!1),i.setRequestHeader("Content-Type","text/plain"),i.send(JSON.stringify(t))}resetdata(){Dt().resetdata(),Mt().resetdata()}sendUsingBeacon(t){window.navigator.sendBeacon(n.urls.heatmapData,JSON.stringify(t))||this.makeXMLRequest(t)}timeOnSite(){window.addEventListener("unload",function(t,i){var e=new Date,n=Math.abs(e-i),r=t._CookieController.get("_nv_ttsOnpage_"+t.windowObjName.auth.bid);r="string"==typeof r&&r.length>0?g(JSON.parse(r)):0;var s=new Date;s.setTime(s.getTime()+2592e6);var o=s.toUTCString();t._CookieController.set("_nv_ttsOnpage_"+t.windowObjName.auth.bid,JSON.stringify(k(r+n)),o)}.bind(null,this,kt),!1)}});var At,It,_t=gt,Nt={actionsSet:"",currActionSet:"",currTime:"",currTimeSlot:"",recStartTime:"",timeline:[],recordingTime:0},jt=null;function Pt(){var t=this;this.canvas=null,this.width=0,this.height=0,this.actions=[],this.mouseDown=!1,this.mouse=!0,this.currentRecording=null,this.recordings=[],this.lastMouseX=-1,this.lastMouseY=-1,this.bgColor="rgb(255,255,255)";var i=["Delete","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Backspace"],e=["url","text","tel","search","number","email"];Pt.onMouseMove=function(i){var e=new Ut(Math.floor(i.pageX),Math.floor(i.pageY),0);null!=t.currentRecording&&t.currentRecording.addAction(e),clearTimeout(It),It=setTimeout(()=>{At.stopRecording()},6e5)},Pt.onClickRec=function(i){var e=new Ut(Math.floor(i.pageX),Math.floor(i.pageY),1,b(i.target));null!=t.currentRecording&&t.currentRecording.addAction(e)},Pt.onScroll=function(i){var e=new Ut(0,Math.floor(window.scrollY),2);null!=t.currentRecording&&t.currentRecording.addAction(e)},Pt.onkey=function(n){var r=b(n.target);if(!_t.restricted_fields.includes(n.target)&&n.key&&(n.key.length<=1||-1!=i.indexOf(n.key))&&"INPUT"==n.target.nodeName&&"password"!=n.target.type){var s="";e.indexOf(n.target.type)&&(s=n.target.selectionEnd);var o=new Ut(n.key,r,3,s);null!=t.currentRecording&&t.currentRecording.addAction(o)}},this.startRecording=function(i){t.currentRecording=new qt(this),t.recordings=[],t.recordings.push(t.currentRecording),t.currentRecording.start(),i||window.removeEventListener("keydown",Pt.onkey)},this.stopRecording=function(){null!=t.currentRecording&&t.currentRecording.stop(),t.currentRecording=null},this.emitData=function(i,e){null!=t.currentRecording&&t.currentRecording.emitData(i,e)},this.removeListener=function(){document.removeEventListener("mousemove",Pt.onMouseMove),document.removeEventListener("click",Pt.onClickRec,!0),window.removeEventListener("scroll",Pt.onScroll),window.removeEventListener("keydown",Pt.onkey)},Pt.__init=function(){_t.makeStructure.init(document),document.addEventListener("mousemove",Pt.onMouseMove,!0),document.addEventListener("click",Pt.onClickRec,!0),window.addEventListener("scroll",Pt.onScroll,!0),window.addEventListener("keydown",Pt.onkey,!0)},Pt.__init()}function qt(t){var i=this;this.drawing=t,this.timeSlots={},this.buffer=[],this.actionSetBuffer=[],this.timeInterval=100,this.pageRecordingTime=100,this.currTime=0,this.started=!1,this.intervalId=null,this.currTimeSlot=0,this.actionsSet=null,this.currActionSet=null,this.recStartTime=null,this.pauseInfo=null,this.timeoutID,this.activityFlag=!0;var{documentElement:e,body:n}=document;this.height=Math.max(n.scrollHeight,n.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),this.path=window.location.href,this.emitData=(t,i)=>{if(yt.getDisconnect()){var e=this.addCommonDataToSendData(i);yt.emit(e,t)}},this.addCommonDataToSendData=function(t){return t&&Object.keys(t).length>0&&(t.brandID=t.brandID||i.drawing.brandID,t.visitorID=t.visitorID||i.drawing.visitorID,t.connection_id=t.connection_id||i.drawing.socketID,t.connectionStatus="connected",t.pageUniqueKey=i.drawing.page_unique_key,t.recordingTime=(i.pageRecordingTime/1e3).toFixed(3),t.timestamp=t.timestamp?t.timestamp:+new Date),t},this.start=function(){i.currTime=0,i.currTimeSlot=-1,i.actionsSet=null,i.pauseInfo=null,i.recStartTime=(new Date).getTime(),i.intervalId=window.setInterval(i.onInterval,i.timeInterval),i.intervalTimeData=window.setInterval(i.sendTimeData,1e3),i.started=!0,i.trackActivity()},this.stop=function(){null!=i.intervalId&&(window.clearInterval(i.intervalId),i.intervalId=null,window.clearInterval(i.sendTimeData),i.intervalTimeData=null),i.started=!1,null!=i.actionsSet&&(Nt.currTime=i.currTime,Nt.started=i.started,Nt.intervalId=i.intervalId,Nt.currTimeSlot=i.currTimeSlot,Nt.actionsSet=i.actionsSet,Nt.currActionSet=i.currActionSet,Nt.recStartTime=i.recStartTime)},this.onInterval=function(){if(i.pageRecordingTime=(new Date).getTime()-i.recStartTime,i.buffer.length>0){var t=(new Date).getTime()-i.recStartTime;if(null==i.currActionSet)i.currActionSet=new Rt(t,i.buffer),i.actionsSet=i.currActionSet;else{var e=i.currActionSet;i.currActionSet=new Rt(t,i.buffer),e.next=i.currActionSet}i.actionSetBuffer.push(Object.assign({},i.currActionSet)),i.buffer=[]}i.currTime+=i.timeInterval},this.addAction=function(t){i.started&&i.buffer.push(t)},this.sendTimeData=function(){if(i.actionSetBuffer.length>0){var t=i.actionSetBuffer;i.actionSetBuffer=[];var e=O(t);if(Array.isArray(e)&&e.length>0){var n=null;e.forEach((t,r)=>{var s={distributedArray:!0};s.length=e.length,s.dArray={[r]:t},n=n?n+1:+new Date,s.timestamp=n,i.emitData("recording-socket-dataSet",s)})}else i.emitData("recording-socket-dataSet",{actionSet:t});i.actionSetBuffer=[]}},this.trackActivity=function(){document.addEventListener("mousemove",i.resetTimer,!1),document.addEventListener("mousedown",i.resetTimer,!1),document.addEventListener("keypress",i.resetTimer,!1),document.addEventListener("DOMMouseScroll",i.resetTimer,!1),document.addEventListener("mousewheel",i.resetTimer,!1),document.addEventListener("touchmove",i.resetTimer,!1),document.addEventListener("MSPointerMove",i.resetTimer,!1),i.startTimer()},this.startTimer=function(){i.timeoutID=window.setTimeout(i.goInactive,3e5)},this.resetTimer=function(){window.clearTimeout(i.timeoutID),i.goActive()},this.goInactive=function(){i.activityFlag||(i.activityFlag=!0,i.emitData("disconnectSocket",{socket_id:jt}))},this.goActive=function(){i.activityFlag&&(i.activityFlag=!1),i.startTimer()}}function Ct(){this.actionTime=+new Date,this.actionType=null,this.x=0,this.y=0,this.isMovable=!1,this.index=0,arguments.length>0&&(this.actionType=arguments.length<=0?void 0:arguments[0]),arguments.length>2&&(this.x=arguments.length<=1?void 0:arguments[1],this.y=arguments.length<=2?void 0:arguments[2]),(arguments.length<=3?void 0:arguments[3])&&(this.elem="",this.elem=arguments.length<=3?void 0:arguments[3])}function Ut(t,i,e,n){this.type=e,Ct.call(this,1,t,i,n)}function Rt(t,i){this.actions=i,this.interval=t,this.next=null,this.mutation=_t.makeStructure?_t.makeStructure.getMutation():(console.log("yes"),[])}function Lt(t,i,e){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&("Missing Data"!==r.responseText||e||i())},r.open("POST",e?n.urls.hmContentUrl:n.urls.contentUrl,!0),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.setRequestHeader("credentials","include"),r.send(JSON.stringify(t))}Ut.prototype=new Ct;var xt={init:function(t,i,e){var n,r,s,o,a;if(At=At||new Pt,_t.currentUser=(n=[],r=_t.recordingCamp,Object.keys(r).forEach(t=>{var i,e;try{"string"==typeof(e=sessionStorage.getItem("_nv_rec_"+r[t]))&&e.length>0?i=e+"//1":(i=r[t]+"//"+m(),sessionStorage.setItem("_nv_rec_"+r[t],i)),n.push(i)}catch(t){console.log(t)}}),n),_t.currentUser){jt=i.socket_id;var h=(new Date).getTime(),u={user:window.notify_visitors.Optimize.data.brandID+"//"+i.socket_id+"//"+_t.currentUser,content:_t.makeStructure.getStructure(),recStartTime:h,path:location.pathname};if(u.content&&JSON.parse(u.content)&&0===Object.keys(u.content).length&&(u.blankContent=!0),u.resources&&Array.isArray(u.resources)&&0===u.resources.length&&(u.blankResources=!0),i.isSPA||(s=document,o=window,a=()=>{var t=_t.makeStructure.getResource(document);t&&Array.isArray(t)&&(u.resources=t),Lt(u,e)},"complete"==s.readyState?a():o.addEventListener?o.addEventListener("load",a,!1):o.attachEvent&&o.attachEvent("onload",a)),At.socketID=i.socket_id,At.brandID=window.notify_visitors.Optimize.data.brandID,At.page_unique_key=i.page_unique_key,_t.currentUser&&Array.isArray(_t.currentUser)&&_t.currentUser.length>0){var c=_t.currentUser[0].split("//");At.visitorID=c[1]}i.isSPA||At.startRecording(t);var{documentElement:f,body:d}=document,v=Math.max(d.scrollHeight,d.offsetHeight,f.clientHeight,f.scrollHeight,f.offsetHeight),l={brandID:window.notify_visitors.Optimize.data.brandID,domain:i.domain,isSPA:i.isSPA,path:location.pathname,ipAddress:i.ipAddress,pageheight:v,pagewidth:document.body.clientWidth,resolution:window.innerWidth+"x"+window.innerHeight,linkReferrer:document.referrer,pageUrl:window.location.href,currentUser:_t.currentUser,rec_camp_details:i.rec_camp_details,recStartTime:h,userAgent:navigator.userAgent,cookieData:i.cookieData};At.emitData("recording-socket",l)}},stop:function(){return At.stopRecording},removeListener:function(){return At.removeListener},makeXMLRequest:Lt};function Ht(t){var i,e=Mt();i=e.lastBtn&&e.lastBtn.length>0?e.lastBtn:e.lastAttr,"success"===t[1]?(e.lastTrack&&e.lastTrack.hasOwnProperty(i)&&delete e.lastTrack[i],(e.lastBtn&&e.lastBtn.length||e.lastAttr&&e.lastAttr.length)&&(e.lastBtn="",e.lastAttr=""),e.dropOf&&e.dropOf.hasOwnProperty(i)&&(e.dropOf[i]=""),e.success&&e.success.hasOwnProperty(i)?e.success[i]+=1:e.success[i]=1,e.form_timetocomplete&&e.form_timetocomplete.hasOwnProperty(i)?e.form_timetocomplete[i]=Math.abs((new Date-u())/1e3).toFixed(3):(e.form_timetocomplete={},e.form_timetocomplete[i]=Math.abs((new Date-u())/1e3).toFixed(3))):"fail"===t[1]&&(e.failed&&e.failed.hasOwnProperty(i)?e.failed[i]+=1:e.failed[i]=1)}var zt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=[];if(document&&document.cookie){var e=document.cookie.split(";");"all"===t&&(i=e),Array.isArray(t)&&e&&e.length>0&&(i=e.filter(function(i){var e=i.trim().split("=")[0];return!!t.includes(e)||0===e.indexOf("_nv_")}))}return i},Jt=document.body,Wt=document.documentElement,Bt={};class Ft{constructor(t,i){this._resData=t,this._windowObj=i[e].Optimize.data,this._nvRecording=xt,this._heatmapData,this._formData,this._getdata=_t,this._nvAck=Ht,this.addScript=(t,i,e,n)=>{var r=document.createElement("script");return""!==i&&""!==e&&r.setAttribute(i,e),r.type="text/javascript",r.src=t,n&&(r.onload=n),r},this.stopRecording=this.stopRecording.bind(this),this.cleanupListener=this.cleanupListener.bind(this),this.handleResponse=this.handleResponse.bind(this),this.handledatatosend=this.handledatatosend.bind(this),this.bodyloadHandler=this.bodyloadHandler.bind(this),this._CookieController=new S,this.socket_id=null}stopRecording(){this._nvRecording.stop()}cleanupListener(){this._nvRecording.removeListener()}handleResponse(){var t=!0;if("fail"===this._resData.Authentication)t=!1;else{h(),c(),d(),this._heatmapData=Dt(),this._formData=Mt(),this._getdata.loadListner(),this._getdata.timeOnSite(),this._windowObj.cookie_path=window.location.pathname;var i=y(this._resData);if(i.recording){var e=function(t){this.socket_id=t,this._nvRecording.init(this._resData.recording.keyStrokes,{domain:this._resData.domain,currentUser:this._getdata.currentUser,rec_camp_details:this._resData.recording.rec_camp_details,isSPA:notify_visitors.spa,socket_id:t,cookieData:zt(),ipAddress:this._resData.recording.ipAddress,page_unique_key:this._resData.recording.page_unique_key},this.cleanupListener)}.bind(this);yt.getDisconnect()?e(yt.getConnectedWebSocket().id):yt.init(e,this.cleanupListener),this._getdata.recordingCamp=this._resData.recording.rec_campaigns,this._getdata.rec_camp_details=this._resData.recording.rec_camp_details,this._getdata.oDomain=this._resData.domain,window.addEventListener("unload",this.stopRecording,!1);var n=this._resData.recording.restricted_fields;Array.isArray(n)&&n.length>0&&n.forEach(function(t){if(t){var i;try{i=document.querySelector(t)}catch(t){i=""}i&&this._getdata.restricted_fields.push(i)}})}if(i.heatMap||i.abTest){document.addEventListener("click",this._heatmapData.clicks,!0),document.addEventListener("mousemove",this._heatmapData.mflow,!0),document.addEventListener("scroll",this._heatmapData.scroll,!0),i.heatMap&&(this._heatmapData.heatMap=!0,this._heatmapData.heatmapCamp=this._resData.heatmaps.hm_campaigns,this._heatmapData.ipAddress=this._resData.heatmaps.ipAddress?this._resData.heatmaps.ipAddress:i.abTest&&this._resData.abTest.ipAddress?this._resData.abTest.ipAddress:null,this._heatmapData.altMethod=this._resData.heatmaps.alt_method||!1,this._heatmapData.device=this._resData.heatmaps.device||null,this._heatmapData.pageUniqueKey=this._resData.heatmaps.page_unique_key);var r=function(t){var e=this._heatmapData.getHmCommanData(this._resData);if(e.cookieData=zt(),i.abTest){var n=this._resData.abTest;e.abTest_hm=[],Object.keys(n).forEach(function(t,i){"object"==typeof n[i]&&Object.keys(n[i]).length>0&&n[i].campDetail&&n[i].campDetail.heatmap&&1==n[i].campDetail.heatmap&&e.abTest_hm.push({cid:n[i].cid,vid:n[i].vid})})}if(e.connection_id=t,e.connectionStatus="connected",this._heatmapData.sendCommonData(e),this._heatmapData.sendHeatmapData(t),e.altMethod){var r=new nt,s=function(){r.init(document);var i={hmUser:!0,user:this._resData.brandID+"//"+t,content:r.getStructure(),domain:this._resData.domain?this._resData.domain:"",path:location.pathname?location.pathname:"/",alt_method:e.altMethod,device:e.device,hmCampaigns:e.heatmapCamp},n=r.getResource(document);n&&Array.isArray(n)&&(i.resources=n),this._nvRecording.makeXMLRequest(i,this._heatmapData.cleanupHmListener,1)}.bind(this);["interactive","complete"].includes(document.readyState)?s():setTimeout(s,100)}}.bind(this);if(i.recording||notify_visitors.spa)if(yt.checkSocketConnection())yt.checkConnection(r,this.cleanupListener);else var s=setInterval(()=>{yt.checkSocketConnection()&&(yt.checkConnection(r,this.cleanupListener),clearInterval(s))},100);else yt.init(r,this.cleanupListener)}if(i.form_data){Bt.thispage=Object.assign({},window.location),window.addEventListener("unload",this._getdata.saveData,!1),Bt.oDomain=this._getdata.windowObjName.domain,Bt.routeType=notify_visitors.routingType?notify_visitors.routingType:"",Bt.nv_auth=notify_visitors.auth,Bt.thispage=Object.assign({},window.location),Jt=document.body,Wt=document.documentElement;var o=Jt?Math.max(Jt.scrollHeight,Jt.offsetHeight):0,a=Wt?Math.max(Wt.clientHeight,Wt.scrollHeight,Wt.offsetHeight):0;Bt.height=o||a?Math.max(a,o):0}if(i.form_data)if(document.body)this.formAnalysis();else var u=window.setInterval(()=>{this.bodyloadHandler(u)},100)}return t}bodyloadHandler(t){document.body&&(clearInterval(t),this.formAnalysis())}formAnalysis(){if(this._formData.form_id=this._resData.form_data.form_id,this._formData.field_id=this._resData.form_data.id,this._formData.form_button=this._resData.form_data.button,this._formData.field_name=this._resData.form_data.name,this._formData.field_selector=this._resData.form_data.selector,this._formData.field_id||this._formData.field_name){Object.keys(this._formData.field_id).forEach(function(t){for(var i=0;i<this._formData.field_id[t].length;i++){var e=document.getElementById(this._formData.field_id[t][i]);if(null!=e){var n=e.getAttribute("nvform");n?e.setAttribute("nvform",n+"-"+t):e.setAttribute("nvform",t)}}},this),Object.keys(this._formData.field_selector).forEach(function(t){for(var i=0;i<this._formData.field_selector[t].length;i++){var e=document.querySelector(this._formData.field_selector[t][i]);if(null!=e){var n=e.getAttribute("nvform");n?e.setAttribute("nvform",n+"-"+t):e.setAttribute("nvform",t)}}},this),Object.keys(this._formData.field_name).forEach(function(t){for(var i=["INPUT","TEXTAREA","SELECT","DATALIST","BUTTON","A"],e=0;e<this._formData.field_name[t].length;e++)for(var n=document.getElementsByName(this._formData.field_name[t][e]),r=0;r<n.length;r++)if(n&&null!=n[r]&&i.indexOf(n[r].tagName)>=0){var s=n[r].getAttribute("nvform");s?n[r].setAttribute("nvform",s+"-"+t):n[r].setAttribute("nvform",t)}},this),this._formData.id_node=Array.prototype.slice.call(document.querySelectorAll("[nvform]"));for(var t=0;t<this._formData.id_node.length;t++){this._formData.id_node[t].addEventListener("focus",this._formData.formFocus,!0),this._formData.id_node[t].addEventListener("blur",this._formData.formBlur,!0);var i=this._formData.id_node[t].getAttribute("nvform");this._formData.dropOf.hasOwnProperty(i)||(this._formData.dropOf[i]="nvPage")}if(this._formData.form_button){Object.keys(this._formData.form_button).forEach(function(t){if(this._formData.form_button[t].hasOwnProperty("id"))var i=document.getElementById(this._formData.form_button[t].id);else if(this._formData.form_button[t].hasOwnProperty("cssSelector"))i=document.querySelector(this._formData.form_button[t].cssSelector);if(null!=i){var e=i.getAttribute("nvbtn");e?i.setAttribute("nvbtn",e+"-"+t):i.setAttribute("nvbtn",t)}},this),this._formData.btn_node=Array.prototype.slice.call(document.querySelectorAll("[nvbtn]"));for(t=0;t<this._formData.btn_node.length;t++)this._formData.btn_node[t].addEventListener("click",this._formData.formbtn,!0)}}this._formData.id_node.sort(function(t,i){return t.isEqualNode(i)?0:2===t.compareDocumentPosition(i)?1:-1})}handledatatosend(){var t={url:Bt.thispage,height:Bt.height,oDomain:Bt.oDomain,routeType:Bt.routeType};_t.saveData(t)}}var Kt=new Ft(window[e].Optimize.data,window);return Kt.handleResponse(),Ft.nvHandler=Kt._nvAck,Ft});
